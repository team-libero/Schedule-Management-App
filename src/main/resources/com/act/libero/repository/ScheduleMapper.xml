<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.act.libero.repository.ScheduleMapper">

    <!-- スケジュール情報取得 -->
    <select id="selectSchedule" resultType="com.act.libero.entity.Schedule">
        SELECT schedule.title_name,
               schedule.from_date_time,
               schedule.to_date_time,
               schedule.address,
               schedule.memo,
               schedule.users_group_id,
               users.last_name,
               users.first_name,
               schedule.user_id,
               schedule.updated_at
        FROM schedule INNER JOIN users ON schedule.user_id = users.user_id
        WHERE schedule_id = #{scheduleId} AND schedule.delete_flag = 0    
    </select>

    <update id="deleteSchedule">
        UPDATE schedule 
        SET delete_flag = 1,
            deleted_at = CURRENT_DATE() 
        WHERE schedule_id = #{scheduleId}
         AND delete_flag = 0
         AND updated_at = #{updatedAt}
    </update>

</mapper>